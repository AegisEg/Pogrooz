{"version":3,"sources":["Pages/User/Messages/Dialog.js"],"names":["Messages","state","isFetching","dialogs","this","props","dialogsUser","find","dialog","user","_id","match","params","id","dialogsActions","updateOnline","apiToken","isGetted","dialogLoad","setState","dialogGet","then","isLoading","isNotFound","className","to","style","maxWidth","marginLeft","onClick","e","preventDefault","lastLocation","history","push","pathname","name","last","first","middle","online","OnlineDate","onlineAt","unRead","messages","filter","x","isRead","loading","React","Component","connect","dispatch","bindActionCreators","withRouter","withLastLocation"],"mappings":"uPAaMA,E,4MACJC,MAAQ,CACNC,YAAY,G,kEAEO,IAAD,OACdC,EAAUC,KAAKC,MAAMF,QAAQG,YAG9BH,EAAQA,QAAQI,MACf,SAACC,GAAD,OAAYA,EAAOC,KAAKC,MAAQ,EAAKL,MAAMM,MAAMC,OAAOC,OAS1DT,KAAKC,MAAMS,eAAeC,aACxBX,KAAKC,MAAMM,MAAMC,OAAOC,GACxBT,KAAKC,MAAMI,KAAKO,UAIfb,EAAQA,QAAQI,MACf,SAACC,GAAD,OAAYA,EAAOC,KAAKC,MAAQ,EAAKL,MAAMM,MAAMC,OAAOC,MACxDI,UAEFb,KAAKC,MAAMS,eAAeI,WACxBd,KAAKC,MAAMM,MAAMC,OAAOC,GACxBT,KAAKC,MAAMI,KAAKO,UAEpBZ,KAAKe,SAAS,CAAEjB,YAAY,KApB5BE,KAAKC,MAAMS,eACRM,UAAUhB,KAAKC,MAAMM,MAAMC,OAAOC,GAAIT,KAAKC,MAAMI,KAAKO,UACtDK,MAAK,WACJ,EAAKF,SAAS,CAAEjB,YAAY,S,+BAoB1B,IAAD,OACHM,EAASJ,KAAKC,MAAMF,QAAQG,YAAYH,QAAQI,MAAK,SAACC,GACxD,OAAOA,EAAOC,KAAKC,MAAQ,EAAKL,MAAMM,MAAMC,OAAOC,MAGrD,OACE,oCACE,kBAAC,IAAD,CAASS,UAAWlB,KAAKH,MAAMC,aAC9BM,IAAWA,EAAOe,YACjB,yBAAKC,UAAU,gBACb,yBAAKA,UAAU,mBACb,wBAAIA,UAAU,SAAd,0DACA,yBAAKA,UAAU,oBACb,yBAAKA,UAAU,QACb,kBAAC,OAAD,CACEA,UAAU,sCACVC,GAAG,IACHC,MAAO,CACLC,SAAU,OACVC,WAAY,QAEdC,QAAS,SAACC,GACRA,EAAEC,iBACE,EAAK1B,MAAM2B,aACb,EAAK3B,MAAM4B,QAAQC,KACjB,EAAK7B,MAAM2B,aAAaG,UAG1B,EAAK9B,MAAM4B,QAAQC,KAAK,eAd9B,kCAoBA,0BAAMV,UAAU,sCACbhB,EAAOC,KAAK2B,KAAKC,KADpB,IAC2B7B,EAAOC,KAAK2B,KAAKE,MAAO,IAChD9B,EAAOC,KAAK2B,KAAKG,QAEpB,0BAAMf,UAAU,WACZhB,EAAOC,KAAK+B,QACZ,oCAAGC,YAAWjC,EAAOC,KAAKiC,WAE3BlC,EAAOC,KAAK+B,QAAU,gDAG3B,+BAGJ,kBAAC,IAAD,CACEG,OAAQnC,EAAOoC,SAASC,QACtB,SAACC,GAAD,OAAQA,EAAEC,QAAUD,EAAErC,KAAKC,MAAQ,EAAKL,MAAMI,KAAKC,OAErDsC,QAASxC,IAAWA,EAAOS,SAC3BT,OAAQA,MAIZJ,KAAKH,MAAMC,cAAgBM,GAAUA,EAAOe,aAC5C,kBAAC,IAAD,W,GA7Fa0B,IAAMC,WA8GdC,uBAXS,SAAClD,GACvB,MAAO,CACLQ,KAAMR,EAAMQ,KACZN,QAASF,EAAME,YAGnB,SAA4BiD,GAC1B,MAAO,CACLtC,eAAgBuC,YAAmBvC,EAAgBsC,MAGxCD,CAGbG,YAAWC,2BAAiBvD","file":"static/js/12.1202631d.chunk.js","sourcesContent":["// App\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\";\r\nimport Chat from \"../../../Partials/Chat/Dialog\";\r\nimport NoMatch from \"../../NoMatch\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport { withLastLocation } from \"react-router-last-location\";\r\nimport * as dialogsActions from \"../../../redux/actions/dialogs\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { OnlineDate } from \"../../../controllers/TimeController\";\r\nimport ArrowDown from \"../../../img/arrowDownperple.svg\";\r\nimport Loading from \"../../../Elements/Loading\";\r\nclass Messages extends React.Component {\r\n  state = {\r\n    isFetching: true,\r\n  };\r\n  componentDidMount() {\r\n    let dialogs = this.props.dialogs.dialogsUser;\r\n\r\n    if (\r\n      !dialogs.dialogs.find(\r\n        (dialog) => dialog.user._id === this.props.match.params.id\r\n      )\r\n    ) {\r\n      this.props.dialogsActions\r\n        .dialogGet(this.props.match.params.id, this.props.user.apiToken)\r\n        .then(() => {\r\n          this.setState({ isFetching: false });\r\n        });\r\n    } else {\r\n      this.props.dialogsActions.updateOnline(\r\n        this.props.match.params.id,\r\n        this.props.user.apiToken\r\n      );\r\n\r\n      if (\r\n        !dialogs.dialogs.find(\r\n          (dialog) => dialog.user._id === this.props.match.params.id\r\n        ).isGetted\r\n      )\r\n        this.props.dialogsActions.dialogLoad(\r\n          this.props.match.params.id,\r\n          this.props.user.apiToken\r\n        );\r\n      this.setState({ isFetching: false });\r\n    }\r\n  }\r\n  render() {\r\n    let dialog = this.props.dialogs.dialogsUser.dialogs.find((dialog) => {\r\n      return dialog.user._id === this.props.match.params.id;\r\n    });\r\n\r\n    return (\r\n      <>\r\n        <Loading isLoading={this.state.isFetching} />\r\n        {dialog && !dialog.isNotFound && (\r\n          <div className=\"article-page\">\r\n            <div className=\"container-fluid\">\r\n              <h2 className=\"title\">Сообщения</h2>\r\n              <div className=\"chat-header mt-3\">\r\n                <div className=\"mb-1\">\r\n                  <Link\r\n                    className=\"href hover left-angle f-14 angle-go\"\r\n                    to=\"/\"\r\n                    style={{\r\n                      maxWidth: \"50px\",\r\n                      marginLeft: \"20px\",\r\n                    }}\r\n                    onClick={(e) => {\r\n                      e.preventDefault();\r\n                      if (this.props.lastLocation) {\r\n                        this.props.history.push(\r\n                          this.props.lastLocation.pathname\r\n                        );\r\n                      } else {\r\n                        this.props.history.push(\"/messages\");\r\n                      }\r\n                    }}\r\n                  >\r\n                    Назад\r\n                  </Link>\r\n                  <span className=\"d-inline-block f-18 text-left mr-3\">\r\n                    {dialog.user.name.last} {dialog.user.name.first}{\" \"}\r\n                    {dialog.user.name.middle}\r\n                  </span>\r\n                  <span className=\"online\">\r\n                    {!dialog.user.online && (\r\n                      <>{OnlineDate(dialog.user.onlineAt)}</>\r\n                    )}\r\n                    {dialog.user.online && <>online</>}\r\n                  </span>\r\n                </div>\r\n                <hr />\r\n              </div>\r\n            </div>\r\n            <Chat\r\n              unRead={dialog.messages.filter(\r\n                (x) => !x.isRead && x.user._id !== this.props.user._id\r\n              )}\r\n              loading={dialog && !dialog.isGetted}\r\n              dialog={dialog}\r\n            />\r\n          </div>\r\n        )}\r\n        {!this.state.isFetching && (!dialog || dialog.isNotFound) && (\r\n          <NoMatch />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    user: state.user,\r\n    dialogs: state.dialogs,\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    dialogsActions: bindActionCreators(dialogsActions, dispatch),\r\n  };\r\n}\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(withLastLocation(Messages)));\r\n"],"sourceRoot":""}