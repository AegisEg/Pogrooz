(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[18],{913:function(e,t,i){"use strict";i.r(t);var r={};i.r(r),i.d(r,"reviewsGet",(function(){return m})),i.d(r,"reviewsLoad",(function(){return y})),i.d(r,"saveReview",(function(){return f}));var n=i(6),s=i(7),a=i(9),o=i(8),c=i(0),p=i.n(c),l=i(32),v=i(2),u=i(17),w=i(12),h=i(26),d=i(55),m=function(e,t){return function(i){"me"===e&&i({type:v.mc,payload:{}}),"my"===e&&i({type:v.rc,payload:{}}),fetch("".concat(u.a.urlApi,"/api/article/getMyReviews"),{method:"post",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({type:e})}).then((function(e){return e.json()})).then((function(t){var r=t.reviews;"me"===e&&i({type:v.kc,payload:{reviews:r}}),"my"===e&&i({type:v.pc,payload:{reviews:r}})}))}},y=function(e,t){return function(i){var r;"me"===e&&(r=w.a.getState().reviews.reviewsMe.reviews[w.a.getState().reviews.reviewsMe.reviews.length-1]._id,i({type:v.mc,payload:{}})),"my"===e&&(r=w.a.getState().reviews.reviewsMy.reviews[w.a.getState().reviews.reviewsMy.reviews.length-1]._id,i({type:v.rc,payload:{}})),fetch("".concat(u.a.urlApi,"/api/article/getMyReviews"),{method:"post",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({type:e,lastReviewId:r})}).then((function(e){return e.json()})).then((function(t){var r=t.reviews;"me"===e&&i({type:v.lc,payload:{reviews:r}}),"my"===e&&i({type:v.qc,payload:{reviews:r}})}))}},f=function(e,t,i,r){return function(n){return new Promise((function(s,a){r?fetch("".concat(u.a.urlApi,"/api/article/saveReview"),{method:"post",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({review:e,orderId:t._id,userId:i,socketId:d.a.getSocketId()})}).then((function(e){return e.json()})).then((function(e){e.error&&e.errors.map((function(e){h.b.error(e.msg)})),!e.error&&e.newReview&&(t.author._id===e.newReview.author._id?(n({type:v.C,payload:{article:t,newReview:e.newReview}}),n({type:v.sc,payload:{review:e.newReview}})):(n({type:v.K,payload:{article:t,newReview:e.newReview}}),n({type:v.nc,payload:{review:e.newReview}}))),s(e)})):s({})}))}},g=i(39),k=i(59),S=i(85),b=i(185),M=i(37),E=i(419),A=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(n.a)(this,i);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).state={currentStatus:0},e}return Object(s.a)(i,[{key:"componentDidMount",value:function(){this.props.reviews.reviewsMe.isGetted||this.props.reviewsAction.reviewsGet("me",this.props.user.apiToken)}},{key:"onScroll",value:function(){0===this.state.currentStatus&&this.props.reviews.reviewsMe.canLoad&&!this.props.reviews.reviewsMe.isFetching&&this.reviewsBlock.getScrollHeight()-this.reviewsBlock.getScrollTop()<=200+this.reviewsBlock.getClientHeight()&&this.props.reviewsAction.reviewsLoad("me",this.props.user.apiToken),1===this.state.currentStatus&&this.props.reviews.reviewsMy.canLoad&&!this.props.reviews.reviewsMy.isFetching&&this.reviewsBlock.getScrollHeight()-this.reviewsBlock.getScrollTop()<=200+this.reviewsBlock.getClientHeight()&&this.props.reviewsAction.reviewsLoad("my",this.props.user.apiToken)}},{key:"render",value:function(){var e=this,t=0===this.state.currentStatus?this.props.reviews.reviewsMe:this.props.reviews.reviewsMy;return p.a.createElement("div",{className:"loads-page reviews-page"},p.a.createElement("div",{className:"container-fluid"},p.a.createElement("h2",{className:"title"},"\u041e\u0442\u0437\u044b\u0432\u044b"),p.a.createElement("div",{className:"tab_groups"},p.a.createElement("span",{className:"tab_group ".concat(0===this.state.currentStatus?"active":""),onClick:function(){e.props.reviews.reviewsMe.isFetching||e.setState({currentStatus:0},(function(){e.props.reviews.reviewsMe.isGetted||e.props.reviewsAction.reviewsGet("me",e.props.user.apiToken)}))}},"\u041e\u0431\u043e \u043c\u043d\u0435"),p.a.createElement("span",{className:"tab_group ".concat(1===this.state.currentStatus?"active":""),onClick:function(){e.props.reviews.reviewsMy.isFetching||e.setState({currentStatus:1},(function(){e.props.reviews.reviewsMy.isGetted||e.props.reviewsAction.reviewsGet("my",e.props.user.apiToken)}))}},"\u041e\u0442 \u043c\u0435\u043d\u044f"))),p.a.createElement(k.a,{isLoading:!t.isGetted&&t.isFetching}),p.a.createElement(S.a,{isLoading:t.isGetted&&t.isFetching}),p.a.createElement(M.CSSTransitionGroup,{transitionName:"height-animation-item",transitionEnterTimeout:500,transitionLeaveTimeout:1,style:{display:"contents"}},p.a.createElement("div",{className:"articles-block full"},p.a.createElement(b.Scrollbars,{onScroll:function(){e.onScroll()},ref:function(t){e.reviewsBlock=t},renderTrackVertical:function(e){return p.a.createElement("div",{className:"track-vertical"})},renderThumbVertical:function(e){return p.a.createElement("div",{className:"thumb-vertical"})},className:"load-content scroll",autoHide:!0},(t.isGetted||!t.isFetching)&&!!t.reviews.length&&p.a.createElement(p.a.Fragment,null,p.a.createElement("div",{className:"article-block requests-article-block"},t.reviews.map((function(i,r){return p.a.createElement(E.a,{key:r,onChange:function(t,r){e.props.reviewsAction.saveReview({_id:i._id,rating:t,comment:r},i.order,i.user._id,e.props.user.apiToken)},isLast:t.reviews.length===r+1,review:i,isMy:1===e.state.currentStatus})})))),t.isGetted&&!t.reviews.length&&p.a.createElement("div",{className:"text-center"},"\u041e\u0442\u0437\u044b\u0432\u043e\u0432 \u043f\u043e\u043a\u0430 \u043d\u0435\u0442")))))}}]),i}(p.a.Component);t.default=Object(l.b)((function(e){return{user:e.user,reviews:e.reviews}}),(function(e){return{reviewsAction:Object(g.b)(r,e)}}))(A)}}]);
//# sourceMappingURL=18.454565ee.chunk.js.map