{"version":3,"sources":["Partials/PayHistoryTable.js","Pages/User/TarifLk.js"],"names":["PayHistoryTable","state","payments","isFetching","currentPage","countAll","getPaymentHistory","page","setState","fetch","api","urlApi","method","headers","Accept","Authorization","props","user","apiToken","body","JSON","stringify","then","response","json","this","className","Loading","isLoading","transitionName","transitionEnterTimeout","transitionLeaveTimeout","style","display","length","map","item","index","items","duration","tariff","prettyDate","key","scope","Date","updatedAt","toDateR","ban","name","price","discount","startedAt","expiriesAt","Pagination","pageCount","onPageChange","React","Component","Support","day_one","day_two","expiriesTariffAt","isDemo","diffDates","Button","type","onClick","document","getElementById","scrollIntoView","behavior","paddingVertical","Tariffs","to","color","connect"],"mappings":"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","file":"static/js/21.5a829b99.chunk.js","sourcesContent":["import React from \"react\";\r\nimport Pagination from \"../Elements/Pagination\";\r\nimport Loading from \"../Elements/Loading\";\r\nimport { CSSTransitionGroup } from \"react-transition-group\";\r\nimport { prettyDate } from \"../controllers/TimeController\";\r\nimport api from \"../config/api\";\r\nclass PayHistoryTable extends React.Component {\r\n  state = {\r\n    payments: false,\r\n    isFetching: true,\r\n    currentPage: 0,\r\n    countAll: false,\r\n  };\r\n  componentDidMount() {\r\n    this.getPaymentHistory(0);\r\n  }\r\n  getPaymentHistory = (page) => {\r\n    this.setState({ currentPage: page, isFetching: true }, () => {\r\n      fetch(`${api.urlApi}/api/tariffs/payments`, {\r\n        method: \"post\",\r\n        headers: {\r\n          Accept: \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${this.props.user.apiToken}`,\r\n        },\r\n        body: JSON.stringify({ page: page }),\r\n      })\r\n        .then((response) => response.json())\r\n        .then(({ payments, countAll }) => {\r\n          this.setState({ isFetching: false, payments, countAll: countAll });\r\n        });\r\n    });\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"pay-history\">\r\n        <Loading isLoading={this.state.isFetching} />\r\n        <CSSTransitionGroup\r\n          transitionName=\"height-animation-item\"\r\n          transitionEnterTimeout={500}\r\n          transitionLeaveTimeout={1}\r\n          style={{\r\n            display: \"contents\",\r\n          }}\r\n        >\r\n          {!this.state.isFetching &&\r\n            this.state.payments &&\r\n            !!this.state.payments.length && (\r\n              <>\r\n                <h3 className=\"f-16 font-weight-normal mt-3\">\r\n                  История пополнений\r\n                </h3>\r\n                <div className=\"table-wrapper\">\r\n                  <table className=\"table\">\r\n                    <thead>\r\n                      <tr>\r\n                        <th>Дата оплаты</th>\r\n                        <th>Способ оплаты</th>\r\n                        <th>Тариф</th>\r\n                        <th>Сумма</th>\r\n                        <th>Срок</th>\r\n                        <th>Дата действия</th>\r\n                        <th>Статус</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {this.state.payments.map((item, index, items) => {\r\n                        let duration;\r\n                        if (item.tariff) {\r\n                          if (item.tariff.duration <= 28) {\r\n                            duration = item.tariff.duration / 7;\r\n                            if (duration > 1) duration += \" недели\";\r\n                            else duration += \" неделя\";\r\n                          }\r\n                          if (item.tariff.duration > 28) {\r\n                            duration = prettyDate(item.tariff.duration / 30);\r\n                          }\r\n                        }\r\n                        return (\r\n                          <tr key={index}>\r\n                            <th scope=\"row\">\r\n                              {new Date(item.updatedAt).toDateR()}\r\n                            </th>\r\n                            <td>\r\n                              {item.tariff && \"visa / master cart\"}\r\n                              {item.ban && \"----------------\"}\r\n                            </td>\r\n                            <td>\r\n                              {item.tariff && item.tariff.name}\r\n                              {item.ban && \"Возврат\"}\r\n                            </td>\r\n                            <td>\r\n                              {item.tariff && (\r\n                                <>\r\n                                  {item.tariff.price -\r\n                                    (item.tariff.price * item.tariff.discount) /\r\n                                      100}\r\n                                  руб\r\n                                </>\r\n                              )}\r\n                            </td>\r\n                            <td>{item.tariff && duration}</td>\r\n                            <td>\r\n                              {new Date(item.startedAt).toDateR()} -{\" \"}\r\n                              {new Date(item.expiriesAt).toDateR()} г\r\n                            </td>\r\n                            <td>\r\n                              <span className=\"left-angle yellow\">\r\n                                {new Date(item.expiriesAt) > new Date() &&\r\n                                  !(\r\n                                    !!index &&\r\n                                    new Date(items[index - 1].expiriesAt) >\r\n                                      new Date()\r\n                                  ) &&\r\n                                  \"Активен\"}\r\n                                {new Date(item.expiriesAt) > new Date() &&\r\n                                  !!index &&\r\n                                  new Date(items[index - 1].expiriesAt) >\r\n                                    new Date() &&\r\n                                  \"Ожидает\"}\r\n                                {new Date(item.expiriesAt) < new Date() &&\r\n                                  \"Использован\"}\r\n                              </span>\r\n                            </td>\r\n                          </tr>\r\n                        );\r\n                      })}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n                <Pagination\r\n                  currentPage={this.state.currentPage}\r\n                  pageCount={this.state.countAll - 1}\r\n                  onPageChange={this.getPaymentHistory}\r\n                />\r\n              </>\r\n            )}\r\n        </CSSTransitionGroup>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nexport default PayHistoryTable;\r\n","// App\r\nimport React from \"react\";\r\nimport { ReactComponent as Warning } from \"../../img/warning.svg\";\r\n// Router\r\nimport { Link } from \"react-router-dom\";\r\nimport Button from \"../../Elements/Button\";\r\nimport { connect } from \"react-redux\";\r\nimport Tariffs from \"../../Partials/Tariffs\";\r\nimport PayHistoryTable from \"../../Partials/PayHistoryTable\";\r\n\r\nclass Support extends React.Component {\r\n  state = {};\r\n  diffDates(day_one, day_two) {\r\n    return (day_one - day_two) / (60 * 60 * 24 * 1000);\r\n  }\r\n  render() {\r\n    let tariff;\r\n    if (this.props.user.expiriesTariffAt && this.props.user.tariff)\r\n      tariff = this.props.user.tariff;\r\n    if (this.props.user.expiriesTariffAt && !this.props.user.tariff)\r\n      tariff = {\r\n        name: \"Тариф Возврат\",\r\n        isDemo: true,\r\n      };\r\n    if (!this.props.user.expiriesTariffAt && !this.props.user.tariff)\r\n      tariff = false;\r\n    return (\r\n      <div className=\"standart-page\">\r\n        <div className=\"container-fluid\">\r\n          <h2 className=\"title\">Мои тариф</h2>\r\n          <div className=\"row align-items-center\">\r\n            <p className=\"f-14 mt-2 d-inline-block px-3\">\r\n              {!this.props.user.expiriesTariffAt && !tariff && (\r\n                <>\r\n                  <Warning /> Профиль скрыт\r\n                </>\r\n              )}\r\n\r\n              {tariff &&\r\n                this.diffDates(\r\n                  new Date(this.props.user.expiriesTariffAt),\r\n                  new Date()\r\n                ) <= 3 && (\r\n                  <>\r\n                    <span>\r\n                      {tariff.name} {tariff.isDemo ? \"активен\" : \"оплачен\"} до{\" \"}\r\n                      {new Date(this.props.user.expiriesTariffAt).toDateR()}\r\n                    </span>\r\n                  </>\r\n                )}\r\n              {tariff &&\r\n                this.diffDates(\r\n                  new Date(this.props.user.expiriesTariffAt),\r\n                  new Date()\r\n                ) > 3 && (\r\n                  <>\r\n                    <span>\r\n                      {tariff.name} {tariff.isDemo ? \"активен\" : \"оплачен\"} до{\" \"}\r\n                      {new Date(this.props.user.expiriesTariffAt).toDateR()}\r\n                    </span>\r\n                  </>\r\n                )}\r\n            </p>\r\n            <div className=\"col mt-2\">\r\n              <Button\r\n                type=\"fill\"\r\n                className=\"f-12\"\r\n                onClick={() => {\r\n                  document.getElementById(\"tariffs\").scrollIntoView({\r\n                    behavior: \"smooth\",\r\n                  });\r\n                }}\r\n                paddingVertical=\"6px\"\r\n              >\r\n                Пополнить\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <PayHistoryTable user={this.props.user} />\r\n          <h3 className=\"f-16 font-weight-normal mt-4\">Продлить тариф</h3>\r\n          <Tariffs />\r\n          <span className=\"f-14\">Тарификация понедельная.</span>\r\n          <p className=\"f-12 mt-0\">\r\n            *Расчет стоимости дня произведен из расчета 30 дней в месяц,\r\n            указывается в ознакомительных целях.\r\n          </p>\r\n          <span className=\"mb-4 mt-2 d-block\">\r\n            <Link\r\n              to=\"/autopay\"\r\n              className=\"f-14 href-hover\"\r\n              style={{\r\n                color: \"#000\",\r\n              }}\r\n            >\r\n              Настройка автоплатежа\r\n            </Link>\r\n          </span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    user: state.user,\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Support);\r\n"],"sourceRoot":""}